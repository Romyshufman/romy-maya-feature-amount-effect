<!DOCTYPE html>
<html>

<head>
    <title>My experiment</title>
    
    <script src='js/jquery-2.1.1.min.js'></script>
    <script src="js/jspsych.js"></script>
    <script src="plugins/jspsych-resize.js"></script>
    <script src="plugins/jspsych-html-keyboard-response.js"></script>
    <script src="plugins/jspsych-instructions.js"></script>
    <script src="plugins/jspsych-survey-text.js"></script>
    <script src="plugins/jspsych-survey-multi-choice.js"></script>
    <script src="plugins/jspsych-fullscreen.js"></script>
    <script src="plugins/jspsych-html-button-response.js"></script>
    <script src="plugins/jspsych-html-slider-response.js"></script>

    <link href="css/my_exp.css" rel="stylesheet" type="text/css">
    <link href="css/jspsych.css" rel="stylesheet" type="text/css">


<!-- The script below is used for debugging in sentry.com contact Ido Ben Artzi or Yaniv Davidovich -->
<script
  src="https://browser.sentry-cdn.com/6.7.2/bundle.tracing.min.js"
  integrity="sha384-wOrLFfswE3wmvwEzqgo2kc7ksrFcx4ephHugBnWW3jY8ktO8xSi5Lny58pZSpovY"
  crossorigin="anonymous"
></script>
<script>
Sentry.init({
  dsn: "https://e930abb231a542d7b9b087bbdd7736ab@o879085.ingest.sentry.io/5831471",
  integrations: [new Sentry.Integrations.BrowserTracing()],
  // We recommend adjusting this value in production, or using tracesSampler
  // for finer control
  tracesSampleRate: 1.0,
});
    </script>
    <!--This experiment consists of three parts.
    The first part is a change detection task, the second is a dual task of both change detection and two-armed bandit task.
    the third is questionnaires. The code is based on jspsych package. Check the tutorials to understand what's going on here-->
</head>
<style>
    /* all the css is in my_exp.css */
</style>

<body>

    <script>
var iframes = document.querySelectorAll('iframe');
for (var i = 0; i < iframes.length; i++) {
    iframes[i].parentNode.removeChild(iframes[i]);
}
        /*---------------------------------------------------- 
        Experiment starts
        ------------------------------------------------------*/
        var timeline = [];
        var welcome = {
            type: 'html-button-response',
            stimulus: '<p style="text-align: left">Welcome to the <b>first session</b> of the experiment.<br><br>This study, performed by Tel Aviv University, is aimed at gaining a better understanding of learning and memory processes.<br> <b>Your contribution may help our lab develop better clinical treatments.</b><br>'
                + "In this session of the study we will ask you to complete few online games allowing us to examine general cognitive abilities.<br> The experiment should take about <b>30 minutes</b>.<br><br>"
                + 'For your participation in this session, <b>you will earn £2.5.</b> However, you will be paid only if you will complete all of the sessions.<br>'
                + ' You are free to leave at any time by pressing ‘Esc’ and closing your browser but please note that full payment is provided only for full participation.<br> <b>Please be assured that all data is collected anonymously, and we will not keep any personal information besides your Prolific ID.</b><br>'
                + '<br><b>Restrictions:</b> You can only participate if you are aged 18 to 50 and are not currently diagnosed with depression, anxiety, epilepsy, learning disabilities, color blindness, or any other psychiatric or neurological disorders.'
                + '<br>Thank you for your participation and please feel free to contact us using the Prolific platform for any question you might have.',
            choices: ['I confirm that I read and accept the terms mentioned above']
        };
        //timeline.push(welcome) //45sec
        /*---------------------------------------------------- 
        Start instructions variabels
        ------------------------------------------------------*/
        var instructions_general = {
            type: "instructions",
            pages: ["We will now give you general instructions about the experiment",
                "After the general instructions, we will ask you some questions to make sure that you understood everything",
                "The experiment will have <b>3 sessions</b> in <b>3 separate days</b>",
                "Every session will take <b>around 30 minutes</b>",
                "<u>You will get paid ONLY if you will complete all three sessions</u>",
                "The <b>first session</b> is today the 12/07/2021 (GMT+2 time)",
                "The <b>second session</b> will be open <b>tomorrow the 13/07/2021</b>, from <b>10AM to 10PM (GMT+2 time) </b>",
                "The <b>third session</b> will be open <b> the day after tomorrow the 14/07/2021</b>, from <b>10AM to 10PM (GMT+2 time) </b>",
                "If you will do only 1 or 2 sessions, <b>you will not get paid for your participation!</b>",
                "You will be paid <b>only after completing all of the 3 sessions</b>",
                "We will now move on to a short quiz to make sure that all is clear",
                "You may leave now if you will not be able to complete the experiment as described",
            ],
            show_clickable_nav: true,
        };
        var Q1_options = ["1", "2", "3"];
        var Q2_options = ["Yes, I will get money for each session", "No, I will get money only for completing all of the experiment"];
        var Q3_options = ["Tomorrow from 10AM to 10PM (GMT+2 time)", "Whenever I want", "Tomorrow from 10AM to 10PM in my local time zone"];
        var Q4_options = ["Whenever I want", "Tomorrow from 10AM to 10PM (GMT+2 time)", "The day after tomorrow from 10AM to 10PM (GMT+2 time)"];
        var Q5_options = ["After completing the third session", "After every session"];


        var instructions_test_general = {
            type: 'survey-multi-choice',
            questions: [
                { prompt: "How many sessions are there?", name: 'number_of_sessions', correct: '3', options: Q1_options, required: true },
                { prompt: "Will you be paid if you will complete two sessions?", name: 'two_sessions', correct: 'No, I will get money only for completing all of the experiment', options: Q2_options, required: true },
                { prompt: "When the second session will be?", name: 'second_session', correct: 'Tomorrow from 10AM to 10PM (GMT+2 time)', options: Q3_options, required: true },
                { prompt: "When the third session will be?", name: 'third_session', correct: 'The day after tomorrow from 10AM to 10PM (GMT+2 time)', options: Q4_options, required: true },
                { prompt: "When will you be paid?", name: 'time_of_payment', correct: "After completing the third session", options: Q5_options, required: true },
            ],
            data: { trial_name: 'test_general_instructions' }
        };

        var if_trial_general = {
            type: 'html-button-response',
            stimulus: "<p>Sorry. You made a mistake.<br>"
                + "Let’s go back to the instructions. "
                + "Please read them carefully before submitting your answers. <br>"
                + "Thank you!",
            choices: ['Back to instructions']
        }
        var to_repeat_general;
        var check_answers = {
            timeline: [if_trial_general],
            conditional_function: function () {
                // get the data from the previous trial,
                // and check which key was pressed
                to_repeat_general = false;
                var responses_to_test_general = JSON.parse(jsPsych.data.get().filter({ trial_type: 'survey-multi-choice' }).last(1).select('responses').values[0])
                for (i = 0; i < instructions_test_general.questions.length; i++) {
                    current_name = instructions_test_general.questions[i].name;
                    current_correct = instructions_test_general.questions[i].correct
                    if (current_correct != responses_to_test_general[current_name]) {
                        to_repeat_general = true;
                        return to_repeat_general
                    }
                    else {
                        to_repeat_general = false;
                    }
                }
                return to_repeat_general
            }
        }

        var instructions_general_loop = {
            timeline: [instructions_general, instructions_test_general, check_answers],
            loop_function: function () {
                if (to_repeat_general == true) {
                    return true;
                } else {
                    return false;
                }
            }
        }
                timeline.push(instructions_general_loop)
        var success = {
            type: 'html-keyboard-response',
            stimulus: '<p> Great! We will now start the first session.<br><br> <b>Press any key to begin</b> </p>',
        };
        timeline.push(success)
        var zoom = {
            type: 'html-button-response',
            stimulus: '<p> Before we start, please make sure that your browser <b>zoom-in settings are on 100%</b> as shown in the picture.<br><br>'
                + '<img style="text-align: left" class= zoom src="images/zoom.png" >'
                + "You may change it by pressing the + or - signs or by pressing (Ctrl and + or -) on your keyboard. <br><br> "
                + "<b>Having your browser zoom-in settings on 100% is vital</b> for the experiment.<br>"
            ,
            choices: ['I confirm that my browser zoom-in settings are on 100% as shown in the picture']
        };
        timeline.push(zoom)
        var toolbar = {
            type: 'html-button-response',
            stimulus: '<p tyle="text-align: left"> Please make sure that your <b>browser downloads toolbar is closed</b> for the experiment to go well.<br>'
                + '<img class=toolbar src="images/toolbar.png">'
                + 'In the picture above, you can see how to close the toolbar by <b>clicking the right-sided X button</b>.',
            choices: ['I confirm that my browser downloads toolbar is closed']
        };
        timeline.push(toolbar)

        timeline.push({
            type: 'fullscreen',
            
            fullscreen_mode: true,
            message: '<p>We will now move to fullscreen mode and start the instructions.</p>'
            , data: { screen_width: window.screen.width, screen_height: window.screen.height }
        });
        jsPsych.init({
            timeline: timeline,
            preload_images:["images/zoom.png","images/toolbar.png"],

on_finish: function() {

console.log('here')

            $.ajax({
                type: 'POST',
                url: '/save',
                data: {'data': 
                    {
                        prolificId: localStorage.prolific,
                        screen: { screen_width: window.screen.width, screen_height: window.screen.height }
                    }
                },

                success: function() {
                    console.log('success');
                    document.location = '/next'
                 },

                 // Endpoint not running, local save
                 error: function(err) {
                    // alert
                  }
         });






            },
            
        });


    </script>
</body>

</html>